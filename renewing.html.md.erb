---
title: Renewing Expired IPsec Certificates
owner: Security Engineering
---

<strong><%= modified_date %></strong>

This topic describes the basic process that deployers may use to renew any already expired certificates contained in 
the IPsec manifest.

##<a id="about-expiration"></a>About Certificate Expiration

The IPsec Add-on relies upon X.509 certificates to secure the communications between communicating peers.  

Like all certificates, the IPsec certificates have a finite lifetime and eventually expire.  The certificates generated by the 
procedure provided in the installation instructions, [Generate a Self-Signed Certificate](./installing.html#self-signed) 
have a default lifetime of one year.  Regardless of their specific lifetime, all certificates must eventually be rotated, and so 
it is important for the operations team to plan accordingly and remember to rotate the IPsec certificates before they actually expire.  

<p class="note"><strong>IMPORTANT</strong>: Rotating the certificates while they are still valid 
   ensures the maximum availability of the Cloud Foundry platform and avoids any unscheduled interruption in service.</p>

##<a id="renew-certs"></a>Renew Expired IPsec Certificates

To renew expired IPsec certificates, do the following:

1. Retrieve the latest runtime config by running the following command:
    `bosh -e BOSH-ENVIRONMENT runtime-config > PATH-TO-SAVE-THE-RUNTIME-CONFIG`

2. Generate a new set of certificates. 
   For development or test environments, you can use self-signed certificates. 
   For information about self-signed certificates, see [Generate a Self-Signed Certificate](./installing.html#self-signed).

3. In the runtime `config.yml` file saved from step 1, update the `optional` field to `true` and update the certificate fields with new certificates. 
   For more information about these fields,
   see the field descriptions under [Create the IPsec Manifest](./installing.html#create-mfest).
    <pre>
    properties:
      ipsec:
        <strong>optional</strong>: true
        <strong>instance\_certificate</strong>: |
          -----BEGIN CERTIFICATE-----
          EXAMPLEAhigAwIBAgIRAIvrBY2TttU/LeRhO+V1t0YwDQYJKoZIhvcNAQELBQAw
          ...
          -----END CERTIFICATE-----
        <strong>instance\_private\_key</strong>: |
          -----BEGIN EXAMPLE RSA PRIVATE KEY-----
          EXAMPLExRSAxPRIVATExKEYxDATAxEXAMPLExRSAxPRIVATExKEYxDATA
          ...
          -----END EXAMPLE RSA PRIVATE KEY-----
        <strong>ca\_certificates</strong>:
          \- |
            -----BEGIN CERTIFICATE-----
            EXAMPLEAvGgAwIBAgIBATANBgkqhkiG9w0BAQsFADAUMRIwEAYDVQQDEwl0ZXN0
            ...
            -----END CERTIFICATE-----
    </pre>

4. Update the runtime config by running the following command:
    `bosh -e BOSH-ENVIRONMENT update-runtime-config --name=ipsec PATH-TO-SAVE-THE-RUNTIME-CONFIG`<br>

5. Navigate to your **Installation Dashboard** in Ops Manager.
6. If you are using Ops Manager v2.3 or later, click **Review Pending Changes**.
   For more information about this Ops Manager page, 
   see [Reviewing Pending Product Changes](https://docs.pivotal.io/pivotalcf/customizing/review-pending-changes.html).
7. Click **Apply Changes**.
8. Remove the `optional: true` set in step 3.
9. Repeat steps 4 to 7.
